---
import { contact, config } from '../../content/siteContent';
---

<section id="contact" class="section">
  <div class="container-prose">
    <h2 class="mb-4">{contact.title}</h2>

    <p class="text-lg text-light-muted dark:text-dark-muted mb-8">
      {contact.intro}
    </p>

    <!-- Contact Form -->
    <form
      id="contact-form"
      action={config.formspreeEndpoint}
      method="POST"
      class="space-y-6 mb-8"
    >
      <div>
        <label for="name" class="block text-sm font-medium mb-2">
          Name
          <span class="text-red-500" aria-hidden="true">*</span>
        </label>
        <input
          type="text"
          id="name"
          name="name"
          required
          autocomplete="name"
          class="input"
          placeholder={contact.form.namePlaceholder}
        />
      </div>

      <div>
        <label for="email" class="block text-sm font-medium mb-2">
          Email
          <span class="text-red-500" aria-hidden="true">*</span>
        </label>
        <input
          type="email"
          id="email"
          name="email"
          required
          autocomplete="email"
          class="input"
          placeholder={contact.form.emailPlaceholder}
        />
      </div>

      <div>
        <label for="message" class="block text-sm font-medium mb-2">
          Message
          <span class="text-red-500" aria-hidden="true">*</span>
        </label>
        <textarea
          id="message"
          name="message"
          required
          rows="5"
          class="input resize-y min-h-[120px]"
          placeholder={contact.form.messagePlaceholder}
        ></textarea>
      </div>

      <!-- Honeypot field for spam protection -->
      <div class="hidden" aria-hidden="true">
        <input type="text" name="_gotcha" tabindex="-1" autocomplete="off" />
      </div>

      <button
        type="submit"
        class="btn btn-primary w-full sm:w-auto"
        id="submit-button"
      >
        <span id="submit-text">{contact.form.submitText}</span>
        <span id="submitting-text" class="hidden">{contact.form.submittingText}</span>
      </button>

      <!-- Success message -->
      <div
        id="form-success"
        class="hidden p-4 rounded-lg bg-green-50 dark:bg-green-900/20 text-green-800 dark:text-green-200 border border-green-200 dark:border-green-800"
        role="alert"
      >
        <p class="font-medium">{contact.form.successMessage}</p>
      </div>

      <!-- Error message -->
      <div
        id="form-error"
        class="hidden p-4 rounded-lg bg-red-50 dark:bg-red-900/20 text-red-800 dark:text-red-200 border border-red-200 dark:border-red-800"
        role="alert"
      >
        <p class="font-medium">{contact.form.errorMessage}</p>
        <p class="mt-2 text-sm">
          You can also reach me directly at{' '}
          <a href={`mailto:${config.email}`} class="underline">
            {config.email}
          </a>
        </p>
      </div>
    </form>

    <!-- Alternative Contact Methods -->
    <div class="pt-8 border-t border-light-border dark:border-dark-border">
      <p class="text-light-muted dark:text-dark-muted mb-6">
        {contact.note}
      </p>

      <div class="flex flex-wrap gap-4">
        <a
          href={config.linkedIn}
          target="_blank"
          rel="noopener noreferrer"
          class="btn btn-secondary inline-flex items-center gap-2"
        >
          <svg
            class="w-5 h-5"
            fill="currentColor"
            viewBox="0 0 24 24"
            aria-hidden="true"
          >
            <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
          </svg>
          Connect on LinkedIn
        </a>

        <a
          href={`mailto:${config.email}`}
          class="btn btn-secondary inline-flex items-center gap-2"
        >
          <svg
            class="w-5 h-5"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
            aria-hidden="true"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"
            />
          </svg>
          Send an Email
        </a>
      </div>
    </div>
  </div>
</section>

<script>
  const form = document.getElementById('contact-form') as HTMLFormElement;
  const submitButton = document.getElementById('submit-button');
  const submitText = document.getElementById('submit-text');
  const submittingText = document.getElementById('submitting-text');
  const successMessage = document.getElementById('form-success');
  const errorMessage = document.getElementById('form-error');

  if (form && submitButton && submitText && submittingText && successMessage && errorMessage) {
    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      // Hide any previous messages
      successMessage.classList.add('hidden');
      errorMessage.classList.add('hidden');

      // Show loading state
      submitButton.setAttribute('disabled', 'true');
      submitText.classList.add('hidden');
      submittingText.classList.remove('hidden');

      try {
        const formData = new FormData(form);
        const response = await fetch(form.action, {
          method: 'POST',
          body: formData,
          headers: {
            Accept: 'application/json',
          },
        });

        if (response.ok) {
          // Success
          form.reset();
          successMessage.classList.remove('hidden');
          successMessage.focus();
        } else {
          // Server error
          throw new Error('Form submission failed');
        }
      } catch (error) {
        // Network or other error
        errorMessage.classList.remove('hidden');
        errorMessage.focus();
      } finally {
        // Reset button state
        submitButton.removeAttribute('disabled');
        submitText.classList.remove('hidden');
        submittingText.classList.add('hidden');
      }
    });
  }
</script>
