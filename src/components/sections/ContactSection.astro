---
import { contact, config } from '../../content/siteContent';
---

<section id="contact" class="py-16 md:py-24 border-t border-light-border dark:border-dark-border">
  <div class="max-w-2xl mx-auto px-6">
    <h2 class="text-sm font-medium uppercase tracking-widest text-light-muted dark:text-dark-muted mb-4">
      {contact.title}
    </h2>

    <p class="text-light-text/85 dark:text-dark-text/85 mb-10">
      {contact.intro}
    </p>

    <!-- Contact Form -->
    <form
      id="contact-form"
      action={config.formspreeEndpoint}
      method="POST"
      class="space-y-5 mb-10"
    >
      <div>
        <label for="name" class="sr-only">Name</label>
        <input
          type="text"
          id="name"
          name="name"
          required
          autocomplete="name"
          class="input"
          placeholder={contact.form.namePlaceholder}
        />
      </div>

      <div>
        <label for="email" class="sr-only">Email</label>
        <input
          type="email"
          id="email"
          name="email"
          required
          autocomplete="email"
          class="input"
          placeholder={contact.form.emailPlaceholder}
        />
      </div>

      <div>
        <label for="message" class="sr-only">Message</label>
        <textarea
          id="message"
          name="message"
          required
          rows="4"
          class="input resize-y min-h-[100px]"
          placeholder={contact.form.messagePlaceholder}
        ></textarea>
      </div>

      <!-- Honeypot -->
      <div class="hidden" aria-hidden="true">
        <input type="text" name="_gotcha" tabindex="-1" autocomplete="off" />
      </div>

      <button
        type="submit"
        class="inline-flex items-center justify-center px-5 py-2.5 text-sm font-medium rounded-md bg-light-text dark:bg-dark-text text-light-bg dark:text-dark-bg hover:opacity-90 transition-opacity"
        id="submit-button"
      >
        <span id="submit-text">{contact.form.submitText}</span>
        <span id="submitting-text" class="hidden">{contact.form.submittingText}</span>
      </button>

      <div
        id="form-success"
        class="hidden p-4 rounded-md bg-green-50 dark:bg-green-900/20 text-green-800 dark:text-green-200 text-sm"
        role="alert"
      >
        {contact.form.successMessage}
      </div>

      <div
        id="form-error"
        class="hidden p-4 rounded-md bg-red-50 dark:bg-red-900/20 text-red-800 dark:text-red-200 text-sm"
        role="alert"
      >
        <p>{contact.form.errorMessage}</p>
        <p class="mt-1">
          Reach me directly at{' '}
          <a href={`mailto:${config.email}`} class="underline">{config.email}</a>
        </p>
      </div>
    </form>

    <!-- Alternative Contact -->
    <div class="flex items-center gap-2 text-sm text-light-muted dark:text-dark-muted">
      <span>Or reach out via</span>
      <a
        href={config.linkedIn}
        target="_blank"
        rel="noopener noreferrer"
        class="text-light-text dark:text-dark-text no-underline hover:text-light-accent dark:hover:text-dark-accent transition-colors font-medium"
      >
        LinkedIn
      </a>
      <span>or</span>
      <a
        href={`mailto:${config.email}`}
        class="text-light-text dark:text-dark-text no-underline hover:text-light-accent dark:hover:text-dark-accent transition-colors font-medium"
      >
        email
      </a>
    </div>
  </div>
</section>

<script>
  const form = document.getElementById('contact-form') as HTMLFormElement;
  const submitButton = document.getElementById('submit-button');
  const submitText = document.getElementById('submit-text');
  const submittingText = document.getElementById('submitting-text');
  const successMessage = document.getElementById('form-success');
  const errorMessage = document.getElementById('form-error');

  if (form && submitButton && submitText && submittingText && successMessage && errorMessage) {
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      successMessage.classList.add('hidden');
      errorMessage.classList.add('hidden');
      submitButton.setAttribute('disabled', 'true');
      submitText.classList.add('hidden');
      submittingText.classList.remove('hidden');

      try {
        const formData = new FormData(form);
        const response = await fetch(form.action, {
          method: 'POST',
          body: formData,
          headers: { Accept: 'application/json' },
        });

        if (response.ok) {
          form.reset();
          successMessage.classList.remove('hidden');
        } else {
          throw new Error('Form submission failed');
        }
      } catch {
        errorMessage.classList.remove('hidden');
      } finally {
        submitButton.removeAttribute('disabled');
        submitText.classList.remove('hidden');
        submittingText.classList.add('hidden');
      }
    });
  }
</script>
